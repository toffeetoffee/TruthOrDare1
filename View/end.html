{% extends "base.html" %}
{% block title %}Game Over · Dare or Dare{% endblock %}
{% block content %}
<section class="container py-4">
  <div class="d-flex align-items-center gap-3 mb-3">
    <h2 class="mb-0">Game Over</h2>
    <span class="badge text-bg-secondary">Room <span class="fw-semibold">{{ room_code }}</span></span>
  </div>

  <div class="row g-4">
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-body-tertiary">Top 5 Players</div>
        <ol id="topPlayers" class="list-group list-group-numbered list-group-flush">
          <!-- dynamic -->
        </ol>
      </div>
    </div>
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-body-tertiary">Performed Truths &amp; Dares</div>
        <div class="card-body">
          <ul id="performedList" class="list-group list-group-flush small"></ul>
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex gap-2 mt-4">
    <a href="{{ url_for('index') }}" class="btn btn-primary">Back to Home</a>
    <a href="{{ url_for('index') }}#joinRoom" class="btn btn-outline-secondary">Join a New Room</a>
  </div>
</section>

{% endblock %}

{% block scripts %}
<script>
  // expects that server renders 'scores' and 'history' in context, else fetch via /api/room/{{ room_code }}/summary
  (async () => {
    try {
      const res = await fetch(`/api/room/{{ room_code }}/summary`);
      if (res.ok) {
        const data = await res.json();
        const top = (data.top5 || []).slice(0,5);
        const ul = document.getElementById('topPlayers');
        ul.innerHTML = '';
        top.forEach(p => {
          const li = document.createElement('li');
          li.className = 'list-group-item d-flex justify-content-between align-items-center';
          li.innerHTML = `<span>${p.name}</span><span class="badge text-bg-primary rounded-pill">${p.score}</span>`;
          ul.appendChild(li);
        });

        const hist = data.history || [];
        const hUl = document.getElementById('performedList');
        hist.forEach(it => {
          const li = document.createElement('li');
          li.className = 'list-group-item';
          li.innerHTML = `<div><b>${it.type}</b> — ${it.content}</div>
                          <div class="small text-body-secondary">Performed by ${it.player} · Submitted by ${it.submitted_by || '—'} · Round ${it.round}</div>`;
          hUl.appendChild(li);
        });
      }
    } catch(e){}
  })();
</script>
{% endblock %}
