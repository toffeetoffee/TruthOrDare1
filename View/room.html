<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Room {{ code }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='room_styles.css') }}">
</head>
<body>
  <h1>Dare or Dare</h1>
  
  <div class="room-info">
    <div>Room Code</div>
    <div class="room-code">{{ code }}</div>
    <div style="margin-top: 12px; color: #666;">Share this code with your friends!</div>
  </div>

  <!-- Lobby Section -->
  <div id="lobby-section" class="lobby-section">
    <div class="players-section">
      <h2>Players in Room</h2>
      <ul id="player-list" class="player-list">
        <li class="player-item">Waiting for players...</li>
      </ul>
      <div id="player-count" class="player-count"></div>
    </div>

    <div class="button-group">
      <button class="btn-leave" onclick="leaveRoom()">Leave Room</button>
    </div>

    <div id="host-controls" class="host-controls">
      <div class="button-group">
        <button class="btn-settings" onclick="openSettings()">Settings</button>
        <button id="start-button" class="btn-start" onclick="startGame()">Start Game</button>
      </div>
      <div class="button-group">
        <button class="btn-destroy" onclick="destroyRoom()">Destroy Room</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">Game Settings</div>
      
      <div class="settings-group">
        <label class="settings-label">Countdown Duration (seconds)</label>
        <input type="number" id="setting-countdown" class="settings-input" min="3" max="30" value="10">
        <div class="settings-hint">Time before game starts (3-30 seconds)</div>
      </div>
      
      <div class="settings-group">
        <label class="settings-label">Preparation Duration (seconds)</label>
        <input type="number" id="setting-preparation" class="settings-input" min="10" max="120" value="30">
        <div class="settings-hint">Time to submit truths/dares (10-120 seconds)</div>
      </div>
      
      <div class="settings-group">
        <label class="settings-label">Selection Duration (seconds)</label>
        <input type="number" id="setting-selection" class="settings-input" min="5" max="30" value="10">
        <div class="settings-hint">Time for player to choose truth/dare (5-30 seconds)</div>
      </div>
      
      <div class="settings-group">
        <label class="settings-label">Truth/Dare Duration (seconds)</label>
        <input type="number" id="setting-truthdare" class="settings-input" min="30" max="180" value="60">
        <div class="settings-hint">Time to perform challenge (30-180 seconds)</div>
      </div>
      
      <div class="settings-group">
        <label class="settings-label">Skip Duration (seconds)</label>
        <input type="number" id="setting-skip" class="settings-input" min="3" max="30" value="5">
        <div class="settings-hint">Time remaining after vote skip (3-30 seconds)</div>
      </div>
      
      <div class="settings-group">
        <label class="settings-label">Maximum Rounds</label>
        <input type="number" id="setting-maxrounds" class="settings-input" min="1" max="50" value="10">
        <div class="settings-hint">Number of rounds before game ends (1-50)</div>
      </div>

      <!-- Minigame settings -->
      <div class="settings-group">
        <label class="settings-label">Minigame Chance (%)</label>
        <input type="number" id="setting-minigame-chance" class="settings-input" min="0" max="100" step="0.1" value="20">
        <div class="settings-hint">Chance that a minigame triggers after preparation (0-100%). Default 20%.</div>
      </div>

      <div class="settings-group">
        <label class="settings-label">Minigame Duration (seconds)</label>
        <input type="number" id="setting-minigame-duration" class="settings-input" min="5" max="120" value="15">
        <div class="settings-hint">Duration of the staring contest voting phase (5-120 seconds).</div>
      </div>
      
      <div class="modal-buttons">
        <button class="btn-save" onclick="saveSettings()">Save Settings</button>
        <button class="btn-cancel" onclick="closeSettings()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Game Area -->
  <div id="game-area" class="game-area">
    <!-- Countdown -->
    <div id="countdown-section" style="display: none;">
      <div class="countdown">
        <div>Game Starting In</div>
        <div id="countdown-timer" class="countdown-timer">10</div>
      </div>
    </div>

    <!-- Preparation Phase -->
    <div id="preparation-section" style="display: none;">
      <div class="preparation-phase">
        <div class="phase-timer">
          Preparation Phase: <span id="prep-timer">30</span>s
        </div>
        
        <div class="submission-form">
          <textarea id="truth-dare-text" placeholder="Enter a truth question or dare challenge..."></textarea>
          
          <select id="truth-dare-type">
            <option value="truth">Truth</option>
            <option value="dare">Dare</option>
          </select>
          
          <div style="margin-top: 8px; font-weight: 500;">Add to players:</div>
          <div id="player-checkboxes" class="player-checkboxes">
            <div style="color: #999; text-align: center;">No other players yet</div>
          </div>
          
          <div class="checkbox-controls">
            <button onclick="selectAllPlayers()">Select All</button>
            <button onclick="deselectAllPlayers()">Deselect All</button>
          </div>
          
          <button onclick="submitTruthDare()">Submit</button>
          
          <div id="submission-success" class="submission-success"></div>
        </div>
      </div>
    </div>

    <!-- Minigame Phase: Staring Contest -->
    <div id="minigame-section" style="display: none;">
      <div class="minigame-phase">
        <div class="minigame-header">
          <h2>Staring Contest (Minigame)</h2>
          <div class="minigame-instructions">Non-competing players vote who they think will win. After majority, the other competitor loses and will perform next.</div>
        </div>

        <div class="minigame-competitors">
          <div class="competitor" id="minigame-competitor-a">Competitor A</div>
          <div class="versus">vs</div>
          <div class="competitor" id="minigame-competitor-b">Competitor B</div>
        </div>

        <div id="minigame-vote-buttons" class="minigame-vote-buttons" style="display:none;">
          <button id="minigame-btn-a" class="btn-vote" onclick="voteMinigame(document.getElementById('minigame-competitor-a').textContent)">Vote for A</button>
          <button id="minigame-btn-b" class="btn-vote" onclick="voteMinigame(document.getElementById('minigame-competitor-b').textContent)">Vote for B</button>
        </div>

        <div class="minigame-votes-display">
          <div>Votes: <span id="minigame-vote-count-a">0</span> - <span id="minigame-vote-count-b">0</span></div>
          <div class="minigame-timer-hint">Voting time left shown in the preparation timer area above.</div>
        </div>
      </div>
    </div>

    <!-- Selection Phase -->
    <div id="selection-section" style="display: none;">
      <div class="selection-phase">
        <div class="selection-title">Selected Player</div>
        <div class="selected-player-display" id="selected-player-name">
          ???
        </div>
        <div class="selection-timer">
          Time remaining: <span id="selection-timer">10</span>s
        </div>
        
        <!-- Truth or Dare choice buttons (only for selected player) -->
        <div id="truth-dare-choice" class="truth-dare-buttons" style="display: none;">
          <button class="btn-truth" onclick="selectTruthDare('truth')">Truth</button>
          <button class="btn-dare" onclick="selectTruthDare('dare')">Dare</button>
        </div>
        
        <div id="choice-made" style="margin-top: 20px; font-size: 18px; color: #666; text-align: center; display: none;">
          Choice: <span id="choice-display"></span>
        </div>
      </div>
    </div>

    <!-- Truth/Dare Phase -->
    <div id="truth-dare-section" style="display: none;">
      <div class="truth-dare-phase">
        <div class="phase-header">
          <div class="phase-type" id="phase-type">DARE</div>
          <div class="performing-player">
            <span id="performing-player-name">Alice</span> is performing
          </div>
        </div>
        
        <div class="challenge-text" id="challenge-text">
          Do 10 pushups
        </div>
        
        <div class="phase-timer-large">
          Time: <span id="truth-dare-timer">60</span>s
        </div>
        
        <!-- Vote section (only for non-selected players) -->
        <div id="vote-section" class="vote-section" style="display: none;">
          <button id="vote-skip-button" class="vote-button" onclick="voteSkip()">
            Vote to Skip
          </button>
          <div class="vote-count">
            <span id="vote-count">0</span> / <span id="required-votes">?</span> votes to skip
          </div>
        </div>
      </div>
    </div>

    <!-- End Game Phase -->
    <div id="end-game-section" style="display: none;">
      <div class="end-game-section">
        <div class="end-game-title">ðŸŽ‰ Game Over! ðŸŽ‰</div>
        
        <!-- Scoreboard -->
        <div class="scoreboard">
          <div class="scoreboard-title">Top Players</div>
          <div id="top-players-list">
            <!-- Dynamically populated -->
          </div>
        </div>
        
        <!-- Round History -->
        <div class="round-history">
          <div class="round-history-title">Round History</div>
          <div id="round-history-list">
            <!-- Dynamically populated -->
          </div>
        </div>
        
        <!-- Controls (host only) -->
        <div id="end-game-host-controls" style="display: none;">
          <div class="end-game-controls">
            <button class="btn-settings" onclick="openSettings()">Settings</button>
            <button class="btn-restart" onclick="restartGame()">Restart Game</button>
          </div>
        </div>
        
        <div class="button-group" style="margin-top: 20px;">
          <button class="btn-leave" onclick="leaveRoom()">Leave Room</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js" crossorigin="anonymous"></script>
  <script>
    // Pass template variables to JavaScript
    const ROOM_CODE = '{{ code }}';
    const PLAYER_NAME = '{{ name }}';
  </script>
  <script src="{{ url_for('static', filename='room_script.js') }}"></script>
</body>
</html>
