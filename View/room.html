<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Room {{ code }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='room_styles.css') }}">
</head>
<body>
  <h1>Dare or Dare</h1>
  
  <div class="room-info">
    <div>Room Code</div>
    <div class="room-code">{{ code }}</div>
    <div style="margin-top: 12px; color: #666;">Share this code with your friends!</div>
  </div>

  <!-- Lobby Section -->
  <div id="lobby-section" class="lobby-section">
    <div class="players-section">
      <h2>Players in Room</h2>
      <ul id="player-list" class="player-list">
        <li class="player-item">Waiting for players...</li>
      </ul>
      <div id="player-count" class="player-count"></div>
    </div>

    <div class="button-group">
      <button class="btn-leave" onclick="leaveRoom()">Leave Room</button>
    </div>

    <div id="host-controls" class="host-controls">
      <div class="button-group">
        <button class="btn-settings" onclick="openSettings()">Settings</button>
        <button id="start-button" class="btn-start" onclick="startGame()">Start Game</button>
      </div>
      <div class="button-group">
        <button class="btn-destroy" onclick="destroyRoom()">Destroy Room</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">Game Settings</div>
      
      <!-- Settings Tabs -->
      <div class="settings-tabs">
        <button class="settings-tab active" onclick="showSettingsTab('game')">Game Settings</button>
        <button class="settings-tab" onclick="showSettingsTab('truths')">Default Truths</button>
        <button class="settings-tab" onclick="showSettingsTab('dares')">Default Dares</button>
      </div>
      
      <!-- Game Settings Tab -->
      <div id="settings-tab-game" class="settings-tab-content active">
        <div class="settings-group">
          <label class="settings-label">Countdown Duration (seconds)</label>
          <input type="number" id="setting-countdown" class="settings-input" min="3" max="30" value="10">
          <div class="settings-hint">Time before game starts (3-30 seconds)</div>
        </div>
        
        <div class="settings-group">
          <label class="settings-label">Preparation Duration (seconds)</label>
          <input type="number" id="setting-preparation" class="settings-input" min="10" max="120" value="30">
          <div class="settings-hint">Time to submit truths/dares (10-120 seconds)</div>
        </div>
        
        <div class="settings-group">
          <label class="settings-label">Selection Duration (seconds)</label>
          <input type="number" id="setting-selection" class="settings-input" min="5" max="30" value="10">
          <div class="settings-hint">Time for player to choose truth/dare (5-30 seconds)</div>
        </div>
        
        <div class="settings-group">
          <label class="settings-label">Truth/Dare Duration (seconds)</label>
          <input type="number" id="setting-truthdare" class="settings-input" min="30" max="180" value="60">
          <div class="settings-hint">Time to perform challenge (30-180 seconds)</div>
        </div>
        
        <div class="settings-group">
          <label class="settings-label">Skip Duration (seconds)</label>
          <input type="number" id="setting-skip" class="settings-input" min="3" max="30" value="5">
          <div class="settings-hint">Time remaining after vote skip (3-30 seconds)</div>
        </div>
        
        <div class="settings-group">
          <label class="settings-label">Maximum Rounds</label>
          <input type="number" id="setting-maxrounds" class="settings-input" min="1" max="50" value="10">
          <div class="settings-hint">Number of rounds before game ends (1-50)</div>
        </div>
        
        <div class="settings-group">
          <label class="settings-label">Minigame Chance (%)</label>
          <input type="number" id="setting-minigame" class="settings-input" min="0" max="100" value="20">
          <div class="settings-hint">Chance of triggering a minigame (0-100%)</div>
        </div>
      </div>
      
      <!-- Default Truths Tab -->
      <div id="settings-tab-truths" class="settings-tab-content">
        <div class="list-controls">
          <button class="btn-add" onclick="addDefaultItem('truth')">+ Add Truth</button>
          <button class="btn-edit" onclick="editDefaultItem('truth')">Edit Selected</button>
          <button class="btn-remove" onclick="removeDefaultItems('truth')">Remove Selected</button>
        </div>
        
        <div class="default-list" id="default-truths-list">
          <!-- Populated dynamically -->
        </div>
        
        <div class="list-controls">
          <button class="btn-select-all" onclick="selectAllItems('truth')">Select All</button>
          <button class="btn-deselect-all" onclick="deselectAllItems('truth')">Deselect All</button>
        </div>
      </div>
      
      <!-- Default Dares Tab -->
      <div id="settings-tab-dares" class="settings-tab-content">
        <div class="list-controls">
          <button class="btn-add" onclick="addDefaultItem('dare')">+ Add Dare</button>
          <button class="btn-edit" onclick="editDefaultItem('dare')">Edit Selected</button>
          <button class="btn-remove" onclick="removeDefaultItems('dare')">Remove Selected</button>
        </div>
        
        <div class="default-list" id="default-dares-list">
          <!-- Populated dynamically -->
        </div>
        
        <div class="list-controls">
          <button class="btn-select-all" onclick="selectAllItems('dare')">Select All</button>
          <button class="btn-deselect-all" onclick="deselectAllItems('dare')">Deselect All</button>
        </div>
      </div>
      
      <div class="modal-buttons">
        <button class="btn-save" onclick="saveSettings()">Save & Close</button>
        <button class="btn-cancel" onclick="closeSettings()">Close</button>
      </div>
    </div>
  </div>

  <!-- Game Area -->
  <div id="game-area" class="game-area">
    <!-- Leave button always visible during game -->
    <div class="game-leave-button">
      <button class="btn-leave" onclick="leaveRoom()">Leave Room</button>
    </div>
    
    <!-- Countdown -->
    <div id="countdown-section" style="display: none;">
      <div class="countdown">
        <div>Game Starting In</div>
        <div id="countdown-timer" class="countdown-timer">10</div>
      </div>
    </div>

    <!-- Preparation Phase -->
    <div id="preparation-section" style="display: none;">
      <div class="preparation-phase">
        <div class="phase-timer">
          Preparation Phase: <span id="prep-timer">30</span>s
        </div>
        
        <div class="submission-form">
          <textarea id="truth-dare-text" placeholder="Enter a truth question or dare challenge..."></textarea>
          
          <select id="truth-dare-type">
            <option value="truth">Truth</option>
            <option value="dare">Dare</option>
          </select>
          
          <div style="margin-top: 8px; font-weight: 500;">Add to players:</div>
          <div id="player-checkboxes" class="player-checkboxes">
            <div style="color: #999; text-align: center;">No other players yet</div>
          </div>
          
          <div class="checkbox-controls">
            <button onclick="selectAllPlayers()">Select All</button>
            <button onclick="deselectAllPlayers()">Deselect All</button>
          </div>
          
          <button onclick="submitTruthDare()">Submit</button>
          
          <div id="submission-success" class="submission-success"></div>
        </div>
      </div>
    </div>

    <!-- Selection Phase -->
    <div id="selection-section" style="display: none;">
      <div class="selection-phase">
        <div class="selection-title">Selected Player</div>
        <div class="selected-player-display" id="selected-player-name">
          ???
        </div>
        <div class="selection-timer">
          Time remaining: <span id="selection-timer">10</span>s
        </div>
        
        <!-- Truth or Dare choice buttons (only for selected player) -->
        <div id="truth-dare-choice" class="truth-dare-buttons" style="display: none;">
          <button class="btn-truth" onclick="selectTruthDare('truth')">Truth</button>
          <button class="btn-dare" onclick="selectTruthDare('dare')">Dare</button>
        </div>
        
        <div id="choice-made" style="margin-top: 20px; font-size: 18px; color: #666; text-align: center; display: none;">
          Choice: <span id="choice-display"></span>
        </div>
      </div>
    </div>

    <!-- Minigame Phase -->
    <div id="minigame-section" style="display: none;">
      <div class="minigame-phase">
        <div class="minigame-title">ðŸŽ® Staring Contest! ðŸŽ®</div>
        
        <div class="minigame-description">
          Who will blink first?
        </div>
        
        <div class="minigame-participants">
          <div class="participant-card">
            <div class="participant-name" id="participant-1">Player 1</div>
            <div class="participant-votes" id="participant-1-votes">0 votes</div>
          </div>
          <div class="vs-text">VS</div>
          <div class="participant-card">
            <div class="participant-name" id="participant-2">Player 2</div>
            <div class="participant-votes" id="participant-2-votes">0 votes</div>
          </div>
        </div>
        
        <!-- Voting buttons (only for non-participants) -->
        <div id="minigame-voting" class="minigame-voting" style="display: none;">
          <div class="voting-instruction">Vote for who blinked first:</div>
          <div class="voting-buttons">
            <button class="vote-btn" id="vote-btn-1" onclick="voteMinigame(null)">
              <span id="vote-name-1">Player 1</span> blinked!
            </button>
            <button class="vote-btn" id="vote-btn-2" onclick="voteMinigame(null)">
              <span id="vote-name-2">Player 2</span> blinked!
            </button>
          </div>
          <div class="vote-progress">
            Votes: <span id="minigame-vote-count">0</span> / <span id="minigame-required-votes">?</span>
          </div>
        </div>
        
        <!-- For participants -->
        <div id="minigame-participant-message" class="minigame-participant-message" style="display: none;">
          <p>You are competing! Don't blink! ðŸ‘€</p>
          <p>Other players will vote for who blinked first.</p>
        </div>
      </div>
    </div>

    <!-- Truth/Dare Phase -->
    <div id="truth-dare-section" style="display: none;">
      <div class="truth-dare-phase">
        <div class="phase-header">
          <div class="phase-type" id="phase-type">DARE</div>
          <div class="performing-player">
            <span id="performing-player-name">Alice</span> is performing
          </div>
        </div>
        
        <div class="challenge-text" id="challenge-text">
          Do 10 pushups
        </div>
        
        <div class="phase-timer-large">
          Time: <span id="truth-dare-timer">60</span>s
        </div>
        
        <!-- Vote section (only for non-selected players) -->
        <div id="vote-section" class="vote-section" style="display: none;">
          <button id="vote-skip-button" class="vote-button" onclick="voteSkip()">
            Vote to Skip
          </button>
          <div class="vote-count">
            <span id="vote-count">0</span> / <span id="required-votes">?</span> votes to skip
          </div>
        </div>
      </div>
    </div>

    <!-- End Game Phase -->
    <div id="end-game-section" style="display: none;">
      <div class="end-game-section">
        <div class="end-game-title">ðŸŽ‰ Game Over! ðŸŽ‰</div>
        
        <!-- Scoreboard -->
        <div class="scoreboard">
          <div class="scoreboard-title">Top Players</div>
          <div id="top-players-list">
            <!-- Dynamically populated -->
          </div>
        </div>
        
        <!-- Round History -->
        <div class="round-history">
          <div class="round-history-title">Round History</div>
          <div id="round-history-list">
            <!-- Dynamically populated -->
          </div>
        </div>
        
        <!-- Controls (host only) -->
        <div id="end-game-host-controls" style="display: none;">
          <div class="end-game-controls">
            <button class="btn-settings" onclick="openSettings()">Settings</button>
            <button class="btn-restart" onclick="restartGame()">Restart Game</button>
          </div>
        </div>
        
        <div class="button-group" style="margin-top: 20px;">
          <button class="btn-leave" onclick="leaveRoom()">Leave Room</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js" crossorigin="anonymous"></script>
  <script>
    // Pass template variables to JavaScript
    const ROOM_CODE = '{{ code }}';
    const PLAYER_NAME = '{{ name }}';
  </script>
  <script src="{{ url_for('static', filename='room_script.js') }}"></script>
</body>
</html>